---
title: 从0到1搭建React+TS项目1（上）
published: 2025-07-10
description: "我的项目解释"
image: "./cover.png"
tags: ["React ","TS","Webpack","craco"]
category: React+TS项目1
draft: false
---

## 一、项目初始化：从基础框架到环境配置

### （一）创建React基础项目

最初接触React项目时，`create-react-app`是最便捷的启动工具。只需一行命令即可生成完整的项目骨架：

```bash
npx create-react-app react-app
```

进入项目目录并启动开发服务器后，默认页面会在`localhost:3000`加载，此时项目包含了React开发所需的基础依赖和配置文件。但默认结构包含大量示例代码和冗余文件，为了保持项目简洁，需要进行精简优化。

### （二）精简项目结构

精简后的项目仅保留核心文件，删除无用的示例组件、样式和配置：

- **public目录**：保留`favicon.ico`（网页图标）和`index.html`（HTML模板）
- **src目录**：保留`App.js`（根组件）、`index.js`（入口文件）

同时简化核心文件代码：

- `index.html`仅保留基础HTML结构和`#root`挂载点，确保JavaScript禁用时的提示文本
- `App.js`简化为最基础的函数组件，返回核心DOM结构
- 引入`Fragment`解决多根元素渲染问题，避免额外DOM节点冗余

### （三）搭建规范目录结构

为了提升项目可维护性，设计合理的目录结构至关重要。最终确定的结构如下：

```
/src
  /common          # 全局公用目录
    /fonts         # 字体文件目录
    /images        # 图片资源目录
    /js            # 公用JS工具目录
    /style         # 公用样式目录
      frame.css    # 样式入口（统一引入其他公用样式）
      reset.css    # 清零样式
      global.css   # 全局样式
  /components      # 公共组件目录（如Header等可复用模块）
  /pages           # 页面组件目录（如Home、Login等页面）
  App.js           # 根组件
  index.js         # 项目入口文件
```

全局样式通过`frame.css`统一管理，再在入口文件`index.js`中引入，确保样式全局生效。

## 二、技术栈升级：引入TypeScript与Webpack配置

### （一）TypeScript环境搭建

为提升代码健壮性和开发体验，引入TypeScript进行类型管理：

1. 安装核心依赖：

```bash
pnpm add react react-dom
pnpm add -D @types/react @types/react-dom typescript @types/node
```

2. 生成TypeScript配置文件：

```bash
npx tsc --init
```

3. 改造核心文件为TypeScript格式：
   - 将`App.js`改为`App.tsx`，定义`React.FC`类型的函数组件
   - 将`index.js`改为`index.tsx`，使用`ReactDOM.createRoot`创建根节点并挂载组件

### （二）Webpack完整配置

#### 1. 安装Webpack核心依赖

Webpack相关依赖包括打包核心、开发服务器、配置合并工具等：

```bash
pnpm add webpack webpack-cli webpack-dev-server webpack-merge -D
pnpm add cross-env -D  # 解决跨环境变量兼容问题
```

#### 2. 配置多环境Webpack文件

创建`scripts`目录存放不同环境的配置文件，采用"基础配置+环境配置"的拆分模式：

- `webpack.base.js`：公用配置（入口、输出、插件等基础设置）
- `webpack.dev.js`：开发环境配置（热更新、开发服务器等）
- `webpack.prod.js`：生产环境配置（压缩、优化等）

基本配置如下：
```
const path = require('path');
module.exports = {
 entry: './src/index.js',
 output: {
   filename: 'bundle.js',
   path: path.resolve(__dirname, 'dist')//打包后的代码放在dist目录下
 },
 mode: 'development'// 开发模式
};
```

#### 3. 处理JSX/TSX与HTML文件

- **Babel配置**：安装`babel-loader`及相关预设，实现JSX/TSX语法转换：

```bash
pnpm add -D babel-loader @babel/core @babel/preset-env @babel/preset-react @babel/preset-typescript
```

- **HTML插件**：使用`html-webpack-plugin`自动生成HTML文件并引入打包后的JS：
  - 配置自定义HTML模板
  - 设置页面标题、注入脚本位置等参数
  - 生产环境开启HTML压缩优化

需要在webpack.base.js中添加HTML插件:
```
const HtmlWebpackPlugin = require('html-webpack-plugin');

plugins:[
      new HtmlWebpackPlugin({
        template: path.resolve(__dirname,'../public/index.html'),//自定义HTML模板
        title: ''//页面标题
      }),
    ],
```
:::tip
其他常用webpack插件：**https://blog.csdn.net/weixin_43720095/article/details/107720200**
:::
#### 4. CSS与资源处理

- **开发环境**：使用`style-loader`、`css-loader`和`postcss-loader`处理CSS，实现样式加载和自动前缀添加
- **生产环境**：通过`MiniCssExtractPlugin`提取CSS为单独文件，`CssMinimizerPlugin`压缩CSS体积
- **资源处理**：利用Webpack5的Assets模块处理图片和字体：
  - 小于25kb的资源转为Data URL
  - 大于25kb的资源输出到指定目录并添加哈希值
  - TypeScript环境下通过`global.d.ts`声明资源模块类型

需要在webpack.base.js中添加规则：
```
// webpack.base.js
const path = require('path')
const HtmlWebpackPlugin = require('html-webpack-plugin')
module.exports = {
    entry: path.resolve(__dirname,'../src/index.tsx'),
    output:{
        path: path.resolve(__dirname,'../dist'),//打包后的代码放在dist目录下
        filename: 'bundle.js',//打包文件的名字
    },
    plugins:[
      new HtmlWebpackPlugin({
        template: path.resolve(__dirname,'../public/index.html'),//自定义HTML模板
        title: ''//页面标题
      }),
    ],
    resolve: {
      modules: ["node_modules"],
	    // 配置 extensions 来告诉 webpack 在没有书写后缀时，以什么样的顺序去寻找文件
      extensions: ['.mjs','.js', '.json', '.jsx', '.ts', '.tsx','.html'],
      //给根路径设置一个别名：@
      alias:{
        '@':path.resolve(__dirname,'../src')
      },
    },
    //添加规则
    module: {
    rules: [
      { test: /.(jsx?)|(tsx?)$/,//匹配所有.js文件
        exclude: /node_modules/,//排除 node_modules目录
        use: {
          loader: 'babel-loader',
          options: {
            presets: [
              [
                '@babel/preset-env',
                {
                  targets: 'iOS 9, Android 4.4, last 2 versions, > 0.2%, not dead', // 根据项目配置
                  useBuiltIns: 'usage', // 会根据配置的目标环境找出需要的polyfill进行部分引入
                  corejs: 3, // 使用 core-js@3 版本
                },
              ],
              ['@babel/preset-typescript'],
              ['@babel/preset-react'],
            ],
          },
        },
      },
      { test: /\.(png|jpg|gif)$/i,//图像文件
        type: 'asset/resource',
        parser:{
          dataUrlCondition:{
            maxSize: 25*1024,//25kb
          },
        },
        generator:{
          filename:'assets/imgs/[name].[hash:8][ext]',
        },
      },
      { test: /\.(eot|ttf|woff|woff2)$/i,//字体文件
        type: 'asset/resource',
        parser:{
          dataUrlCondition:{
            maxSize: 25*1024,//25kb
          },
        },
        generator:{
          filename:'assets/fonts/[name].[hash:8][ext]',
        },
      }, 
      {test: /\.(mp4|avi)$/, // 匹配视频文件
      type: 'asset/resource', // 将文件原封不动输出
      generator: {
        filename: 'static/videos/[hash][ext][query]' // 输出路径和命名规则
      }
      },
    ],
  },
}
```

#### 5、配置craco文件
本项目使用"CRA"，想要在CRA配置的样式之外添加上面提到的CSS规则，又不想破坏CRA原有功能，就要采取craco配置。
- **craco配置**：安装craco（我的项目没有使用Lass/Sass）

```
# 安装Craco核心包
pnpm add @craco/craco -D

# 可选：根据需求安装Craco插件（如处理Less/Sass）
pnpm add craco-less -D
```
craco添加规则：
```
// craco.config.js
const path = require('path');

module.exports = {
  webpack: {
    resolve:{
      alias : {
        'swiper/css': path.resolve(__dirname, 'node_modules/swiper/swiper.min.css'),
        'swiper/css/navigation': path.resolve(__dirname, 'node_modules/swiper/modules/navigation.min.css'),
        'swiper/css/pagination': path.resolve(__dirname, 'node_modules/swiper/modules/pagination.min.css')
      },
      extensions: ['.tsx', '.ts', '.jsx', '.js', '.json']
    },

    configure: {
      output: {
        publicPath: '/-Love-And-Deepspace/',
      },
    },

    configure: (webpackConfig) => {
      // 修复 CSS 加载器配置
      webpackConfig.module.rules.forEach(rule => {
        if (rule.oneOf) {
          rule.oneOf = rule.oneOf.map(loader => {
            if (loader.test && loader.test.toString().includes('css')) {
              return {
                test: /\.css$/,
                use: [
                  'style-loader',
                  {
                    loader: 'css-loader',
                    options: {
                      importLoaders: 1,
                      modules: false
                    }
                  },
                  'postcss-loader'
                ],
                exclude: /node_modules/,
                sideEffects: true
              };
            }
            return loader;
          });
        }
        return rule;
      });
      return webpackConfig;
    },
    
  },
  devServer: {
    port: 3000,
    open: true
  }
}
```
:::tip
设置craco配置之后，沿用CRA默认的webpack规则，所以生成目录存放到默认的build目录下。
:::




---
title: Expressive Code Example
published: 2024-04-10
description: How code blocks look in Markdown using Expressive Code.
tags: [Markdown, Blogging, Demo]
category: Examples
draft: false
---

Here, we'll explore how code blocks look using [Expressive Code](https://expressive-code.com/). The provided examples are based on the official documentation, which you can refer to for further details.

## Expressive Code

### Syntax Highlighting

[Syntax Highlighting](https://expressive-code.com/key-features/syntax-highlighting/)

#### Regular syntax highlighting

```js
console.log('This code is syntax highlighted!')
```

#### Rendering ANSI escape sequences

```ansi
ANSI colors:
- Regular: [31mRed[0m [32mGreen[0m [33mYellow[0m [34mBlue[0m [35mMagenta[0m [36mCyan[0m
- Bold:    [1;31mRed[0m [1;32mGreen[0m [1;33mYellow[0m [1;34mBlue[0m [1;35mMagenta[0m [1;36mCyan[0m
- Dimmed:  [2;31mRed[0m [2;32mGreen[0m [2;33mYellow[0m [2;34mBlue[0m [2;35mMagenta[0m [2;36mCyan[0m

256 colors (showing colors 160-177):
[38;5;160m160 [38;5;161m161 [38;5;162m162 [38;5;163m163 [38;5;164m164 [38;5;165m165[0m
[38;5;166m166 [38;5;167m167 [38;5;168m168 [38;5;169m169 [38;5;170m170 [38;5;171m171[0m
[38;5;172m172 [38;5;173m173 [38;5;174m174 [38;5;175m175 [38;5;176m176 [38;5;177m177[0m

Full RGB colors:
[38;2;34;139;34mForestGreen - RGB(34, 139, 34)[0m

Text formatting: [1mBold[0m [2mDimmed[0m [3mItalic[0m [4mUnderline[0m
```

### Editor & Terminal Frames

[Editor & Terminal Frames](https://expressive-code.com/key-features/frames/)

#### Code editor frames

```js title="my-test-file.js"
console.log('Title attribute example')
```

---

```html
<!-- src/content/index.html -->
<div>File name comment example</div>
```

#### Terminal frames

```bash
echo "This terminal frame has no title"
```

---

```powershell title="PowerShell terminal example"
Write-Output "This one has a title!"
```

#### Overriding frame types

```sh frame="none"
echo "Look ma, no frame!"
```

---

```ps frame="code" title="PowerShell Profile.ps1"
# Without overriding, this would be a terminal frame
function Watch-Tail { Get-Content -Tail 20 -Wait $args }
New-Alias tail Watch-Tail
```

### Text & Line Markers

[Text & Line Markers](https://expressive-code.com/key-features/text-markers/)

#### Marking full lines & line ranges

```js {1, 4, 7-8}
// Line 1 - targeted by line number
// Line 2
// Line 3
// Line 4 - targeted by line number
// Line 5
// Line 6
// Line 7 - targeted by range "7-8"
// Line 8 - targeted by range "7-8"
```

#### Selecting line marker types (mark, ins, del)

```js title="line-markers.js" del={2} ins={3-4} {6}
function demo() {
  console.log('this line is marked as deleted')
  // This line and the next one are marked as inserted
  console.log('this is the second inserted line')

  return 'this line uses the neutral default marker type'
}
```

#### Adding labels to line markers

```jsx {"1":5} del={"2":7-8} ins={"3":10-12}
// labeled-line-markers.jsx
<button
  role="button"
  {...props}
  value={value}
  className={buttonClassName}
  disabled={disabled}
  active={active}
>
  {children &&
    !active &&
    (typeof children === 'string' ? <span>{children}</span> : children)}
</button>
```

#### Adding long labels on their own lines

```jsx {"1. Provide the value prop here:":5-6} del={"2. Remove the disabled and active states:":8-10} ins={"3. Add this to render the children inside the button:":12-15}
// labeled-line-markers.jsx
<button
  role="button"
  {...props}

  value={value}
  className={buttonClassName}

  disabled={disabled}
  active={active}
>

  {children &&
    !active &&
    (typeof children === 'string' ? <span>{children}</span> : children)}
</button>
```

#### Using diff-like syntax

```diff
+this line will be marked as inserted
-this line will be marked as deleted
this is a regular line
```

---

```diff
--- a/README.md
+++ b/README.md
@@ -1,3 +1,4 @@
+this is an actual diff file
-all contents will remain unmodified
 no whitespace will be removed either
```

#### Combining syntax highlighting with diff-like syntax

```diff lang="js"
  function thisIsJavaScript() {
    // This entire block gets highlighted as JavaScript,
    // and we can still add diff markers to it!
-   console.log('Old code to be removed')
+   console.log('New and shiny code!')
  }
```

#### Marking individual text inside lines

```js "given text"
function demo() {
  // Mark any given text inside lines
  return 'Multiple matches of the given text are supported';
}
```

#### Regular expressions

```ts /ye[sp]/
console.log('The words yes and yep will be marked.')
```

#### Escaping forward slashes

```sh /\/ho.*\//
echo "Test" > /home/test.txt
```

#### Selecting inline marker types (mark, ins, del)

```js "return true;" ins="inserted" del="deleted"
function demo() {
  console.log('These are inserted and deleted marker types');
  // The return statement uses the default marker type
  return true;
}
```

### Word Wrap

[Word Wrap](https://expressive-code.com/key-features/word-wrap/)

#### Configuring word wrap per block

```js wrap
// Example with wrap
function getLongString() {
  return 'This is a very long string that will most probably not fit into the available space unless the container is extremely wide'
}
```

---

```js wrap=false
// Example with wrap=false
function getLongString() {
  return 'This is a very long string that will most probably not fit into the available space unless the container is extremely wide'
}
```

#### Configuring indentation of wrapped lines

```js wrap preserveIndent
// Example with preserveIndent (enabled by default)
function getLongString() {
  return 'This is a very long string that will most probably not fit into the available space unless the container is extremely wide'
}
```

---

```js wrap preserveIndent=false
// Example with preserveIndent=false
function getLongString() {
  return 'This is a very long string that will most probably not fit into the available space unless the container is extremely wide'
}
```

## Collapsible Sections

[Collapsible Sections](https://expressive-code.com/plugins/collapsible-sections/)

```js collapse={1-5, 12-14, 21-24}
// All this boilerplate setup code will be collapsed
import { someBoilerplateEngine } from '@example/some-boilerplate'
import { evenMoreBoilerplate } from '@example/even-more-boilerplate'

const engine = someBoilerplateEngine(evenMoreBoilerplate())

// This part of the code will be visible by default
engine.doSomething(1, 2, 3, calcFn)

function calcFn() {
  // You can have multiple collapsed sections
  const a = 1
  const b = 2
  const c = a + b

  // This will remain visible
  console.log(`Calculation result: ${a} + ${b} = ${c}`)
  return c
}

// All this code until the end of the block will be collapsed again
engine.closeConnection()
engine.freeMemory()
engine.shutdown({ reason: 'End of example boilerplate code' })
```

## Line Numbers

[Line Numbers](https://expressive-code.com/plugins/line-numbers/)

### Displaying line numbers per block

```js showLineNumbers
// This code block will show line numbers
console.log('Greetings from line 2!')
console.log('I am on line 3')
```

---

```js showLineNumbers=false
// Line numbers are disabled for this block
console.log('Hello?')
console.log('Sorry, do you know what line I am on?')
```

### Changing the starting line number

```js showLineNumbers startLineNumber=5
console.log('Greetings from line 5!')
console.log('I am on line 6')
```
